{"version":3,"file":"createAnimation.js","sources":["uni_modules/uni-transition/components/uni-transition/createAnimation.js"],"sourcesContent":["// const defaultOption = {\r\n// \tduration: 300,\r\n// \ttimingFunction: 'linear',\r\n// \tdelay: 0,\r\n// \ttransformOrigin: '50% 50% 0'\r\n// }\r\n// #ifdef APP-NVUE\r\nconst nvueAnimation = uni.requireNativePlugin('animation')\r\n// #endif\r\nclass MPAnimation {\r\n\tconstructor(options, _this) {\r\n\t\tthis.options = options\r\n\t\t// 在iOS10+QQ小程序平台下，传给原生的对象一定是个普通对象而不是Proxy对象，否则会报parameter should be Object instead of ProxyObject的错误\r\n\t\tthis.animation = uni.createAnimation({\r\n\t\t\t...options\r\n\t\t})\r\n\t\tthis.currentStepAnimates = {}\r\n\t\tthis.next = 0\r\n\t\tthis.$ = _this\r\n\r\n\t}\r\n\r\n\t_nvuePushAnimates(type, args) {\r\n\t\tlet aniObj = this.currentStepAnimates[this.next]\r\n\t\tlet styles = {}\r\n\t\tif (!aniObj) {\r\n\t\t\tstyles = {\r\n\t\t\t\tstyles: {},\r\n\t\t\t\tconfig: {}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tstyles = aniObj\r\n\t\t}\r\n\t\tif (animateTypes1.includes(type)) {\r\n\t\t\tif (!styles.styles.transform) {\r\n\t\t\t\tstyles.styles.transform = ''\r\n\t\t\t}\r\n\t\t\tlet unit = ''\r\n\t\t\tif(type === 'rotate'){\r\n\t\t\t\tunit = 'deg'\r\n\t\t\t}\r\n\t\t\tstyles.styles.transform += `${type}(${args+unit}) `\r\n\t\t} else {\r\n\t\t\tstyles.styles[type] = `${args}`\r\n\t\t}\r\n\t\tthis.currentStepAnimates[this.next] = styles\r\n\t}\r\n\t_animateRun(styles = {}, config = {}) {\r\n\t\tlet ref = this.$.$refs['ani'].ref\r\n\t\tif (!ref) return\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tnvueAnimation.transition(ref, {\r\n\t\t\t\tstyles,\r\n\t\t\t\t...config\r\n\t\t\t}, res => {\r\n\t\t\t\tresolve()\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\t_nvueNextAnimate(animates, step = 0, fn) {\r\n\t\tlet obj = animates[step]\r\n\t\tif (obj) {\r\n\t\t\tlet {\r\n\t\t\t\tstyles,\r\n\t\t\t\tconfig\r\n\t\t\t} = obj\r\n\t\t\tthis._animateRun(styles, config).then(() => {\r\n\t\t\t\tstep += 1\r\n\t\t\t\tthis._nvueNextAnimate(animates, step, fn)\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\tthis.currentStepAnimates = {}\r\n\t\t\ttypeof fn === 'function' && fn()\r\n\t\t\tthis.isEnd = true\r\n\t\t}\r\n\t}\r\n\r\n\tstep(config = {}) {\r\n\t\t// #ifndef APP-NVUE\r\n\t\tthis.animation.step(config)\r\n\t\t// #endif\r\n\t\t// #ifdef APP-NVUE\r\n\t\tthis.currentStepAnimates[this.next].config = Object.assign({}, this.options, config)\r\n\t\tthis.currentStepAnimates[this.next].styles.transformOrigin = this.currentStepAnimates[this.next].config.transformOrigin\r\n\t\tthis.next++\r\n\t\t// #endif\r\n\t\treturn this\r\n\t}\r\n\r\n\trun(fn) {\r\n\t\t// #ifndef APP-NVUE\r\n\t\tthis.$.animationData = this.animation.export()\r\n\t\tthis.$.timer = setTimeout(() => {\r\n\t\t\ttypeof fn === 'function' && fn()\r\n\t\t}, this.$.durationTime)\r\n\t\t// #endif\r\n\t\t// #ifdef APP-NVUE\r\n\t\tthis.isEnd = false\r\n\t\tlet ref = this.$.$refs['ani'] && this.$.$refs['ani'].ref\r\n\t\tif(!ref) return\r\n\t\tthis._nvueNextAnimate(this.currentStepAnimates, 0, fn)\r\n\t\tthis.next = 0\r\n\t\t// #endif\r\n\t}\r\n}\r\n\r\n\r\nconst animateTypes1 = ['matrix', 'matrix3d', 'rotate', 'rotate3d', 'rotateX', 'rotateY', 'rotateZ', 'scale', 'scale3d',\r\n\t'scaleX', 'scaleY', 'scaleZ', 'skew', 'skewX', 'skewY', 'translate', 'translate3d', 'translateX', 'translateY',\r\n\t'translateZ'\r\n]\r\nconst animateTypes2 = ['opacity', 'backgroundColor']\r\nconst animateTypes3 = ['width', 'height', 'left', 'right', 'top', 'bottom']\r\nanimateTypes1.concat(animateTypes2, animateTypes3).forEach(type => {\r\n\tMPAnimation.prototype[type] = function(...args) {\r\n\t\t// #ifndef APP-NVUE\r\n\t\tthis.animation[type](...args)\r\n\t\t// #endif\r\n\t\t// #ifdef APP-NVUE\r\n\t\tthis._nvuePushAnimates(type, args)\r\n\t\t// #endif\r\n\t\treturn this\r\n\t}\r\n})\r\n\r\nexport function createAnimation(option, _this) {\r\n\tif(!_this) return\r\n\tclearTimeout(_this.timer)\r\n\treturn new MPAnimation(option, _this)\r\n}\r\n"],"names":["uni"],"mappings":"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"}