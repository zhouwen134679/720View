{"version":3,"file":"communityAdd.js","sources":["secondPages/communityAdd/communityAdd.vue","E:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/c2Vjb25kUGFnZXNcY29tbXVuaXR5QWRkXGNvbW11bml0eUFkZC52dWU"],"sourcesContent":["<template>\r\n\t<pageBack :titleInfo=\"titleInfo\"></pageBack>\r\n\t<view class=\"content\">\r\n\t\t<view class=\"richtext\">\r\n\t\t\t<input class=\"titleContent\" type=\"text\" placeholder=\"标题\" v-model=\"title\" />\r\n\t\t\t<piaoyiEditor :values=\"values\" :maxlength=\"3000\" :readOnly=\"readOnly\" :photoUrl=\"photoUrl\" :api=\"api\" :name=\"name\" @changes=\"saveContens\" />\r\n\t\t</view>\r\n\t\t<view class=\"uploadImage\">\r\n\t\t\t<view class=\"i\" v-for=\"(item, index) in imageList\" :key=\"index\">\r\n\t\t\t\t<image :src=\"item\" mode=\"aspectFill\"></image>\r\n\t\t\t\t<view class=\"deleteBtn\" @click=\"deleteImage(index, 'error')\">\r\n\t\t\t\t\t<text>×</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"\" v-if=\"imageList.length < 9\" @click=\"chooseImage\">\r\n\t\t\t\t<image class=\"chooseSvg\" src=\"/static/add.svg\" mode=\"\"></image>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"button\">\r\n\t\t\t<view class=\"select\" @click=\"selectTopic\">\r\n\t\t\t\t<picker class=\"picker\" @change=\"changePickerUnit($event, unitList)\" :value=\"indexUnit\" :range=\"unitList\" :range-key=\"'name'\">\r\n\t\t\t\t\t<view class=\"picker\">\r\n\t\t\t\t\t\t<!-- {{unitList[indexUnit].name}} -->\r\n\t\t\t\t\t\t# {{ unitName }}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</picker>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"add\" @click=\"addButton\">发布</view>\r\n\t\t</view>\r\n\t</view>\r\n\t<uni-popup ref=\"popup\" type=\"dialog\">\r\n\t\t<uni-popup-dialog\r\n\t\t\t:type=\"msgType\"\r\n\t\t\tcancelText=\"取消\"\r\n\t\t\tconfirmText=\"确定\"\r\n\t\t\ttitle=\"提示\"\r\n\t\t\tcontent=\"确定要删除此图片吗?\"\r\n\t\t\t@confirm=\"confirmDeleteImage\"\r\n\t\t\t@close=\"dialogClose\"\r\n\t\t></uni-popup-dialog>\r\n\t</uni-popup>\r\n</template>\r\n\r\n<script>\r\nimport pageBack from '/components/title/title.vue';\r\nimport piaoyiEditor from '@/uni_modules/piaoyi-editor/components/piaoyi-editor/piaoyi-editor.vue';\r\nimport { base_url } from '@/utils/request.js';\r\nimport { useUserInfoStore } from '@/store/userInfo.js';\r\nimport { getCommunityTopicAPI, uploadCommunityAPI } from '/apis/community.js';\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\ttitleInfo: {\r\n\t\t\t\ttitleShow: true,\r\n\t\t\t\ttitle: '新增',\r\n\t\t\t\timageUrl: 'http://t73sifiwt.hn-bkt.clouddn.com/pageBack/1.webp',\r\n\t\t\t\theightShow: false,\r\n\t\t\t\tbackShow: true\r\n\t\t\t},\r\n\t\t\treadOnly: false, //是否只读\r\n\t\t\tphotoUrl: 'http://test.com', //服务器图片域名或者ip\r\n\t\t\tapi: '/upload', //上传图片接口地址\r\n\t\t\tname: 'file',\r\n\t\t\tvalues: '',\r\n\t\t\ttitle: '',\r\n\t\t\timageList: [],\r\n\t\t\tuploadImage: [],\r\n\t\t\tindexUnit: 0, // 选中的下标\r\n\t\t\tunitName: '请选择话题', // 默认选项\r\n\t\t\tunitList: [],\r\n\t\t\tgrid_id: null,\r\n\t\t\ttxt: '',\r\n\t\t\tmsgType: 'success'\r\n\t\t};\r\n\t},\r\n\tcomponents: {\r\n\t\tpageBack,\r\n\t\tpiaoyiEditor\r\n\t},\r\n\tonLoad() {\r\n\t\tgetCommunityTopicAPI().then((res) => {\r\n\t\t\tthis.unitList = res.message;\r\n\t\t});\r\n\t},\r\n\tmethods: {\r\n\t\tchooseImage() {\r\n\t\t\tif (this.imageList.length > 9) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '最多只能上传9张图片',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tuni.chooseImage({\r\n\t\t\t\tcount: 9 - this.imageList.length, // 最多可以选择的图片张数\r\n\t\t\t\tsizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图,默认二者都有\r\n\t\t\t\tsourceType: ['album', 'camera'], // 可以指定来源是相册还是相机,默认二者都有\r\n\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\tthis.imageList = this.imageList.concat(res.tempFilePaths);\r\n\t\t\t\t\tthis.uploadImages();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tuploadImages() {\r\n\t\t\tthis.imageList.forEach((item, index) => {\r\n\t\t\t\tconst url = `${base_url}/community/uploadCommunityImage`;\r\n\t\t\t\tconst token = uni.getStorageSync('token');\r\n\t\t\t\tuni.uploadFile({\r\n\t\t\t\t\turl: url,\r\n\t\t\t\t\tfilePath: item,\r\n\t\t\t\t\tname: 'img',\r\n\t\t\t\t\theader: {\r\n\t\t\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\r\n\t\t\t\t\t\tAuthorization: token\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: (uploadRes) => {\r\n\t\t\t\t\t\tthis.uploadImage.push(JSON.parse(uploadRes.data).imageUrl);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tconsole.log(`Image upload failed`, err);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t},\r\n\t\tchangePickerUnit(e, unitList) {\r\n\t\t\tlet index = e.detail.value;\r\n\t\t\tthis.indexUnit = index;\r\n\t\t\tthis.unitName = unitList[index].name;\r\n\t\t\tthis.grid_id = unitList[index].id;\r\n\t\t},\r\n\t\tsaveContens(e) {\r\n\t\t\tthis.txt = e.html;\r\n\t\t},\r\n\t\taddButton() {\r\n\t\t\tif (!this.title || !this.txt || !this.uploadImage || !this.grid_id) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '请填写所有必填项',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconsole.log(useUserInfoStore().$state.userInfo.id)\r\n\r\n\t\t\tif (!useUserInfoStore().$state.userInfo.id) {\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '您未请登录，请登录后再发布...',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t});\r\n\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\turl: '/pages/login/login'\r\n\t\t\t\t\t});\r\n\t\t\t\t}, 3000);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// 转换我想要的格式\r\n\t\t\tconst imageUrlList = `[\"${Object.values(this.uploadImage).join('\",\"')}\"]`;\r\n\t\t\tuploadCommunityAPI({\r\n\t\t\t\ttitle: this.title,\r\n\t\t\t\tcontent: this.txt,\r\n\t\t\t\timageUrl: `[\"${Object.values(this.uploadImage).join('\",\"')}\"]`,\r\n\t\t\t\tgrid_id: this.grid_id,\r\n\t\t\t\tuser_id: useUserInfoStore().$state.userInfo.id\r\n\t\t\t}).then((res) => {\r\n\t\t\t\tif (res.status == 200) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: res.message,\r\n\t\t\t\t\t\ticon: 'none',\r\n\t\t\t\t\t\tmask: true\r\n\t\t\t\t\t});\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tuni.switchTab({\r\n\t\t\t\t\t\t\turl: '/pages/community/community'\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}, 500);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '发布失败',\r\n\t\t\t\t\t\ticon: 'none'\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 删除图片\r\n\t\tdeleteImage(index, type) {\r\n\t\t\tthis.deleteIndex = index; // 保存要删除的图片索引\r\n\t\t\tthis.msgType = type;\r\n\t\t\tthis.$refs.popup.open(type);\r\n\t\t},\r\n\t\tconfirmDeleteImage() {\r\n\t\t\tthis.imageList.splice(this.deleteIndex, 1);\r\n\t\t\tthis.uploadImage.splice(this.deleteIndex, 1);\r\n\t\t\tthis.$refs.popup.close();\r\n\t\t},\r\n\t\tdialogClose() {\r\n\t\t\tthis.$refs.popup.close();\r\n\t\t}\r\n\t}\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.content {\r\n\tpadding-bottom: 200rpx;\r\n\tposition: relative;\r\n\ttop: 200rpx;\r\n\twidth: 100%;\r\n\tmin-height: 300rpx;\r\n\tbackground-color: rgb(255, 251, 241);\r\n\tborder-radius: 40rpx 40rpx 0 0;\r\n\toverflow: hidden;\r\n\tpadding: 40rpx 0;\r\n\tfont-family: '阿里妈妈方圆体 VF Regular' !important;\r\n\r\n\t.richtext {\r\n\t\twidth: 90%;\r\n\t\tmargin: auto;\r\n\r\n\t\t.titleContent {\r\n\t\t\tpadding-bottom: 20rpx;\r\n\t\t\tpadding-left: 10rpx;\r\n\t\t}\r\n\t}\r\n\r\n\t.button {\r\n\t\twidth: 90%;\r\n\t\tmargin: auto;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t\tmargin-top: 50rpx;\r\n\r\n\t\t.add {\r\n\t\t\tpadding: 10rpx 40rpx;\r\n\t\t\tbackground-color: #4d0000;\r\n\t\t\tcolor: #fff;\r\n\t\t\tborder-radius: 10rpx;\r\n\t\t}\r\n\t}\r\n\r\n\t.uploadImage {\r\n\t\tmargin: auto;\r\n\t\twidth: 90%;\r\n\t\tdisplay: grid;\r\n\t\tgrid-template-columns: repeat(3, 1fr);\r\n\t\tgrid-template-rows: repeat(3, 1fr);\r\n\t\tgrid-gap: 10rpx;\r\n\t\theight: 620rpx;\r\n\r\n\t\t.i {\r\n\t\t\tposition: relative;\r\n\r\n\t\t\t.deleteBtn {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\ttop: 10rpx;\r\n\t\t\t\tright: 10rpx;\r\n\t\t\t\twidth: 40rpx;\r\n\t\t\t\theight: 40rpx;\r\n\t\t\t\tbackground-color: rgba(0, 0, 0, 0.5);\r\n\t\t\t\tborder-radius: 50%;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tcolor: #fff;\r\n\t\t\t\tfont-size: 32rpx;\r\n\t\t\t\tz-index: 1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tview {\r\n\t\t\twidth: 200rpx;\r\n\t\t\theight: 200rpx;\r\n\t\t\tborder-radius: 20rpx;\r\n\t\t\toverflow: hidden;\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: center;\r\n\t\t\talign-items: center;\r\n\t\t\tbackground: rgba(0, 0, 0, 0.03);\r\n\r\n\t\t\timage {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t.chooseSvg {\r\n\t\t\t\twidth: 100rpx;\r\n\t\t\t\theight: 100rpx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n</style>\r\n","import MiniProgramPage from 'C:/Users/18706/Desktop/MZ/mazu-前端小程序/secondPages/communityAdd/communityAdd.vue'\nwx.createPage(MiniProgramPage)"],"names":["getCommunityTopicAPI","uni","base_url","useUserInfoStore","uploadCommunityAPI"],"mappings":"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"}