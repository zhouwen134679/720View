{"version":3,"file":"incenseMall.js","sources":["secondPages/incenseMall/incenseMall.vue","../../../../../code/HBuilderX/plugins/uniapp-cli-vite/uniPage:/c2Vjb25kUGFnZXNcaW5jZW5zZU1hbGxcaW5jZW5zZU1hbGwudnVl"],"sourcesContent":["<template>\r\n\t<pageBack :titleInfo=\"titleInfo\"></pageBack>\r\n\t<view class=\"content\">\r\n\t\t<view class=\"header\">\r\n\t\t\t<view class=\"points\">\r\n\t\t\t\t当前香火值：{{ userInfo.incense_points || 0 }}\r\n\t\t\t</view>\r\n\t\t\t<view class=\"tips\">捐款金额等额累计为香火值，可用于兑换心仪礼品。</view>\r\n\t\t</view>\r\n\t\t<view class=\"list\">\r\n\t\t\t<view class=\"item\" v-for=\"item in list\" :key=\"item.id\">\r\n\t\t\t\t<image :src=\"item.imageUrl[0]\" mode=\"aspectFill\"></image>\r\n\t\t\t\t<view class=\"info\">\r\n\t\t\t\t\t<view class=\"name\">{{ item.shopname }}</view>\r\n\t\t\t\t\t<view class=\"cost\">兑换消耗：{{ item.price }} 香火值</view>\r\n\t\t\t\t\t<view class=\"actions\">\r\n\t\t\t\t\t\t<button size=\"mini\" type=\"primary\" @click=\"redeem(item)\">立即兑换</button>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport pageBack from \"/components/title/title.vue\";\r\nimport { getShopListAPI } from \"/apis/shop.js\";\r\nimport { redeemByIncenseAPI } from \"/apis/shop.js\";\r\nimport { useUserInfoStore } from \"/store/userInfo.js\";\r\n\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\ttitleInfo: {\r\n\t\t\t\ttitleShow: true,\r\n\t\t\t\ttitle: \"香火商城\",\r\n\t\t\t\timageUrl: \"http://t73sifiwt.hn-bkt.clouddn.com/pageBack/1.webp\",\r\n\t\t\t\theightShow: false,\r\n\t\t\t\tbackShow: true\r\n\t\t\t},\r\n\t\t\tlist: [],\r\n\t\t\tuserInfo: {}\r\n\t\t};\r\n\t},\r\n\tcomponents: {\r\n\t\tpageBack\r\n\t},\r\n\tonShow() {\r\n\t\tthis.userInfo = { ...useUserInfoStore().$state.userInfo };\r\n\t\tif (!this.userInfo.id) {\r\n\t\t\tuni.showToast({ title: \"请先登录\", icon: \"none\" });\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tuni.navigateTo({ url: \"/pages/login/login\" });\r\n\t\t\t}, 800);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.loadList();\r\n\t},\r\n\tmethods: {\r\n\t\tloadList() {\r\n\t\t\tgetShopListAPI().then((res) => {\r\n\t\t\t\tif (res.status === 200) {\r\n\t\t\t\t\tthis.list = res.message.map((item) => ({\r\n\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\timageUrl: JSON.parse(item.imageUrl)\r\n\t\t\t\t\t}));\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tredeem(item) {\r\n\t\t\tconst cost = Number(item.price);\r\n\t\t\tif ((this.userInfo.incense_points || 0) < cost) {\r\n\t\t\t\treturn uni.showToast({ title: \"香火值不足\", icon: \"none\" });\r\n\t\t\t}\r\n\t\t\tuni.showLoading({ title: \"兑换中\", mask: true });\r\n\t\t\tredeemByIncenseAPI({\r\n\t\t\t\tuser_id: this.userInfo.id,\r\n\t\t\t\tgoods_id: item.id,\r\n\t\t\t\tcost\r\n\t\t\t}).then((res) => {\r\n\t\t\t\tuni.hideLoading();\r\n\t\t\t\tif (res.status === 200) {\r\n\t\t\t\t\tuseUserInfoStore().$state.userInfo.incense_points = res.incense_points;\r\n\t\t\t\t\tthis.userInfo.incense_points = res.incense_points;\r\n\t\t\t\t\tuni.showToast({ title: \"兑换成功\", icon: \"success\" });\r\n\t\t\t\t} else {\r\n\t\t\t\t\tuni.showToast({ title: res.message || \"兑换失败\", icon: \"none\" });\r\n\t\t\t\t}\r\n\t\t\t}).catch((err) => {\r\n\t\t\t\tuni.hideLoading();\r\n\t\t\t\tuni.showToast({ title: err || \"兑换异常\", icon: \"none\" });\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.content {\r\n\tposition: relative;\r\n\ttop: 200rpx;\r\n\tbackground: #fffaf2;\r\n\tmin-height: 100vh;\r\n\tpadding: 20rpx 24rpx 120rpx;\r\n}\r\n.header {\r\n\tmargin-bottom: 20rpx;\r\n\t.points {\r\n\t\tfont-size: 32rpx;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\t.tips {\r\n\t\tmargin-top: 8rpx;\r\n\t\tcolor: #a1661d;\r\n\t\tfont-size: 26rpx;\r\n\t}\r\n}\r\n.list .item {\r\n\tdisplay: flex;\r\n\tbackground: #fff;\r\n\tborder-radius: 16rpx;\r\n\tmargin-bottom: 20rpx;\r\n\toverflow: hidden;\r\n\tbox-shadow: 0 6rpx 20rpx rgba(0,0,0,0.05);\r\n\timage {\r\n\t\twidth: 200rpx;\r\n\t\theight: 200rpx;\r\n\t}\r\n\t.info {\r\n\t\tflex: 1;\r\n\t\tpadding: 16rpx;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tgap: 10rpx;\r\n\t\t.name { font-size: 30rpx; font-weight: 600; }\r\n\t\t.cost { color: #d48806; font-size: 26rpx; }\r\n\t\t.actions { margin-top: auto; display: flex; justify-content: flex-end; }\r\n\t}\r\n}\r\n</style>\r\n\r\n","import MiniProgramPage from 'C:/Users/jiaxi/Desktop/mazu-2/mazu-前端小程序/secondPages/incenseMall/incenseMall.vue'\nwx.createPage(MiniProgramPage)"],"names":["useUserInfoStore","uni","getShopListAPI","redeemByIncenseAPI"],"mappings":";;;;AAyBA,iBAAiB,MAAW;AAK5B,MAAK,YAAU;AAAA,EACd,OAAO;AACN,WAAO;AAAA,MACN,WAAW;AAAA,QACV,WAAW;AAAA,QACX,OAAO;AAAA,QACP,UAAU;AAAA,QACV,YAAY;AAAA,QACZ,UAAU;AAAA,MACV;AAAA,MACD,MAAM,CAAE;AAAA,MACR,UAAU,CAAC;AAAA;EAEZ;AAAA,EACD,YAAY;AAAA,IACX;AAAA,EACA;AAAA,EACD,SAAS;AACR,SAAK,WAAW,EAAE,GAAGA,eAAgB,iBAAA,EAAG,OAAO;AAC/C,QAAI,CAAC,KAAK,SAAS,IAAI;AACtBC,oBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAK,CAAG;AAC7C,iBAAW,MAAM;AAChBA,sBAAAA,MAAI,WAAW,EAAE,KAAK,qBAAsB,CAAA;AAAA,MAC5C,GAAE,GAAG;AACN;AAAA,IACD;AACA,SAAK,SAAQ;AAAA,EACb;AAAA,EACD,SAAS;AAAA,IACR,WAAW;AACVC,+BAAgB,EAAC,KAAK,CAAC,QAAQ;AAC9B,YAAI,IAAI,WAAW,KAAK;AACvB,eAAK,OAAO,IAAI,QAAQ,IAAI,CAAC,UAAU;AAAA,YACtC,GAAG;AAAA,YACH,UAAU,KAAK,MAAM,KAAK,QAAQ;AAAA,UAClC,EAAC;AAAA,QACH;AAAA,MACD,CAAC;AAAA,IACD;AAAA,IACD,OAAO,MAAM;AACZ,YAAM,OAAO,OAAO,KAAK,KAAK;AAC9B,WAAK,KAAK,SAAS,kBAAkB,KAAK,MAAM;AAC/C,eAAOD,cAAAA,MAAI,UAAU,EAAE,OAAO,SAAS,MAAM,OAAO,CAAC;AAAA,MACtD;AACAA,oBAAG,MAAC,YAAY,EAAE,OAAO,OAAO,MAAM,KAAG,CAAG;AAC5CE,mCAAmB;AAAA,QAClB,SAAS,KAAK,SAAS;AAAA,QACvB,UAAU,KAAK;AAAA,QACf;AAAA,MACD,CAAC,EAAE,KAAK,CAAC,QAAQ;AAChBF,sBAAG,MAAC,YAAW;AACf,YAAI,IAAI,WAAW,KAAK;AACvBD,yBAAgB,iBAAA,EAAG,OAAO,SAAS,iBAAiB,IAAI;AACxD,eAAK,SAAS,iBAAiB,IAAI;AACnCC,wBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,UAAQ,CAAG;AAAA,eAC1C;AACNA,8BAAI,UAAU,EAAE,OAAO,IAAI,WAAW,QAAQ,MAAM,OAAO,CAAC;AAAA,QAC7D;AAAA,MACD,CAAC,EAAE,MAAM,CAAC,QAAQ;AACjBA,sBAAG,MAAC,YAAW;AACfA,4BAAI,UAAU,EAAE,OAAO,OAAO,QAAQ,MAAM,OAAK,CAAG;AAAA,MACrD,CAAC;AAAA,IACF;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;AC7FA,GAAG,WAAW,eAAe;"}