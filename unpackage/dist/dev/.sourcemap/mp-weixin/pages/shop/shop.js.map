{"version":3,"file":"shop.js","sources":["pages/shop/shop.vue","E:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvc2hvcC9zaG9wLnZ1ZQ"],"sourcesContent":["<template>\n\t<pageBack :titleInfo=\"titleInfo\"></pageBack>\n\t<view class=\"content\">\n\t\t<view class=\"container\">\n\t\t\t<!-- ceshi -->\n\t\t\t<view class=\"shopName\">\n\t\t\t\t<view class=\"shopTitle\">妈祖周边文创</view>\n\t\t\t\t<view class=\"shopEngTitle\">Cultural around Mazu</view>\n\t\t\t</view>\n\t\t\t<view class=\"input\">\n\t\t\t\t<input type=\"text\" />\n\t\t\t\t<image src=\"../../static/shop/search.png\" mode=\"\"></image>\n\t\t\t</view>\n\t\t\t<view class=\"recommend\">\n\t\t\t\t<view v-for=\"(item, index) in gridList\" :key=\"index\" :class=\"{ active: activeIndex === index }\" @click=\"setActiveGrid(index, item)\">\n\t\t\t\t\t{{ item.grid }}\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<swiper style=\"height: 370rpx; margin-bottom: 40rpx\" :autoplay=\"true\" :interval=\"5000\" :duration=\"400\">\n\t\t\t\t<swiper-item v-for=\"item in recommendList\" :key=\"item.id\">\n\t\t\t\t\t<view class=\"recommendItem\">\n\t\t\t\t\t\t<view class=\"item\" @click=\"toShowDetail(item.id)\">\n\t\t\t\t\t\t\t<view class=\"itemImage\">\n\t\t\t\t\t\t\t\t<image :src=\"item.imageUrl[0]\" mode=\"aspectFill\"></image>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t<view class=\"itemText\">\n\t\t\t\t\t\t\t\t<view class=\"title\">\n\t\t\t\t\t\t\t\t\t{{ item.shopname }}\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t<view class=\"info\">暂未介绍...敬请期待</view>\n\t\t\t\t\t\t\t\t<view class=\"price\">\n\t\t\t\t\t\t\t\t\t<view class=\"left\">\n\t\t\t\t\t\t\t\t\t\t{{ formatPrice(item.price) }}\n\t\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t\t<view class=\"right\">兑换</view>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</swiper-item>\n\t\t\t</swiper>\n\t\t\t<!-- ceshi -->\n\t\t\t<view class=\"shop\">\n\t\t\t\t<view class=\"pubuBox\">\n\t\t\t\t\t<view class=\"pubuItem\">\n\t\t\t\t\t\t<!-- v-for列表循环 -->\n\t\t\t\t\t\t<view class=\"item-masonry\" v-for=\"(item, index) in list\" :key=\"index\" @click=\"toShowDetail(item.id)\">\n\t\t\t\t\t\t\t<image :lazy-load=\"true\" :src=\"item.imageUrl[0]\" mode=\"aspectFill\"></image>\n\t\t\t\t\t\t\t<view class=\"listtitle\">\n\t\t\t\t\t\t\t\t<!-- 这是没有高度的父盒子（下半部分） -->\n\t\t\t\t\t\t\t\t<view class=\"listtitle2\">\n\t\t\t\t\t\t\t\t\t{{ item.shopname }}\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t<view class=\"listtitle3\">\n\t\t\t\t\t\t\t\t\t<text>香火值</text>\n\t\t\t\t\t\t\t\t\t{{ formatPrice(item.price) }}\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n\t<incense-fab></incense-fab>\n\t<tabBar></tabBar>\n</template>\n\n<script>\nimport pageBack from '/components/title/title.vue';\nimport tabBar from '/components/tabbar/tabbar.vue';\nimport IncenseFab from '/components/incense-fab/incense-fab.vue';\nimport { getShopListAPI, getShopGridAPI, gridSearchShopAPI } from '/apis/shop.js';\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\ttitleInfo: {\n\t\t\t\ttitleShow: true,\n\t\t\t\ttitle: '商城',\n\t\t\t\timageUrl: 'http://t73sifiwt.hn-bkt.clouddn.com/pageBack/1.webp',\n\t\t\t\theightShow: false,\n\t\t\t\tbackShow: false\n\t\t\t},\n\t\t\tlist: [],\n\t\t\trecommendList: [],\n\t\t\tgridList: [],\n\t\t\tactiveIndex: 0\n\t\t};\n\t},\n\tonLoad() {\n\t\tthis.getShopList();\n\t},\n\tonShow() {\n\t\tthis.setActiveGrid(0, {\n\t\t\tgrid: '全部'\n\t\t});\n\t\tthis.getGrid();\n\t},\n\tcomponents: {\n\t\tpageBack,\n\t\ttabBar,\n\t\tIncenseFab\n\t},\n\tmethods: {\n\t\t// ========== 新增：价格格式化方法 ==========\n\t\tformatPrice(price) {\n\t\t\t// 完整的容错处理，避免 toFixed 报错\n\t\t\tconst num = Number(price);\n\t\t\t// 如果转换失败（非数字），返回 0.00\n\t\t\treturn isNaN(num) ? '0.00' : num.toFixed(2);\n\t\t},\n\t\t// ========== 原有方法 ==========\n\t\t// 洗牌算法 进行随机操作\n\t\trandomRecommendList(count) {\n\t\t\tconst shuffled = [...this.list];\n\t\t\tfor (let i = shuffled.length - 1; i > 0; i--) {\n\t\t\t\tconst j = Math.floor(Math.random() * (i + 1));\n\t\t\t\t[shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\n\t\t\t}\n\t\t\treturn shuffled.slice(0, count);\n\t\t},\n\t\tsetActiveGrid(index, item) {\n\t\t\tthis.activeIndex = index;\n\t\t\tgridSearchShopAPI(item.grid)\n\t\t\t\t.then((res) => {\n\t\t\t\t\t// 容错：判断 res.message 是否存在\n\t\t\t\t\tif (res && res.message) {\n\t\t\t\t\t\tthis.list = res.message.map((item) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t...item,\n\t\t\t\t\t\t\t\timageUrl: JSON.parse(item.imageUrl || '[]') // 容错：imageUrl 为空时解析为空数组\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.list = [];\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tconsole.error('分类查询失败：', err);\n\t\t\t\t\tthis.list = [];\n\t\t\t\t});\n\t\t},\n\t\t// 获取种类\n\t\tgetGrid() {\n\t\t\tgetShopGridAPI()\n\t\t\t\t.then((res) => {\n\t\t\t\t\t// 容错1：判断 res.message 是否存在\n\t\t\t\t\tconst originalList = res?.message || [];\n\t\t\t\t\t// 过滤掉 \"其他\" 分类\n\t\t\t\t\tconst filteredList = originalList.filter((item) => item?.grid !== '其他');\n\n\t\t\t\t\t// 修复核心：shuffleArray 函数必须返回打乱后的数组\n\t\t\t\t\tconst shuffleArray = (array) => {\n\t\t\t\t\t\t// 先复制数组，避免修改原数组\n\t\t\t\t\t\tconst newArray = [...array];\n\t\t\t\t\t\tfor (let i = newArray.length - 1; i > 0; i--) {\n\t\t\t\t\t\t\tconst j = Math.floor(Math.random() * (i + 1));\n\t\t\t\t\t\t\t[newArray[i], newArray[j]] = [newArray[j], newArray[i]]; // 交换元素\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn newArray; // 关键：返回打乱后的数组\n\t\t\t\t\t};\n\n\t\t\t\t\t// 容错2：打乱前判断数组是否为空\n\t\t\t\t\tconst shuffledList = shuffleArray(filteredList);\n\t\t\t\t\t// 容错3：slice 前判断数组是否为空，避免 undefined.slice 报错\n\t\t\t\t\tconst selectedItems = shuffledList.length > 0 ? shuffledList.slice(0, 3) : [];\n\n\t\t\t\t\tthis.gridList = [{ grid: '全部' }, ...selectedItems, { grid: '其他' }];\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tconsole.error('获取分类列表失败：', err);\n\t\t\t\t\t// 出错时设置默认分类\n\t\t\t\tthis.gridList = [{ grid: '全部' }, { grid: '其他' }];\n\t\t\t\t});\n\t\t},\n\t\t// 获取商品数据\n\t\tgetShopList() {\n\t\t\tgetShopListAPI()\n\t\t\t\t.then((res) => {\n\t\t\t\t\t// 容错：判断 res.message 是否存在\n\t\t\t\t\tif (res && res.message) {\n\t\t\t\t\t\tthis.list = res.message.map((item) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t...item,\n\t\t\t\t\t\t\t\timageUrl: JSON.parse(item.imageUrl || '[]') // 容错：imageUrl 为空时解析为空数组\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.recommendList = this.randomRecommendList(5);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.list = [];\n\t\t\t\t\t\tthis.recommendList = [];\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((err) => {\n\t\t\t\t\tconsole.error('获取商品列表失败：', err);\n\t\t\t\t\tthis.list = [];\n\t\t\t\t\tthis.recommendList = [];\n\t\t\t\t});\n\t\t},\n\t\t// 获取商品页面\n\t\ttoShowDetail(id) {\n\t\t\tconsole.log(id);\n\t\t\tuni.navigateTo({\n\t\t\t\turl: `/secondPages/shopDetail/shopDetail?shopId=${id}`\n\t\t\t});\n\t\t}\n\t},\n\tonPageScroll(e) {\n\t\tif (e.scrollTop >= 80) {\n\t\t\tthis.titleInfo.heightShow = true;\n\t\t}\n\t\tif (e.scrollTop < 80) {\n\t\t\tthis.titleInfo.heightShow = false;\n\t\t}\n\t}\n};\n</script>\n\n<style lang=\"less\" scoped>\n.container {\n\tpadding-bottom: 200rpx;\n\tposition: relative;\n\ttop: 200rpx;\n\twidth: 100%;\n\tmin-height: 300rpx;\n\tbackground-color: rgb(255, 251, 241);\n\tborder-radius: 40rpx 40rpx 0 0;\n\toverflow: hidden;\n\n\t// 瀑布流\n\t.shop {\n\t\twidth: 95%;\n\t\tmargin: auto;\n\t\tfont-family: '阿里妈妈方圆体 VF Regular';\n\n\t\t.pubuItem {\n\t\t\tcolumn-count: 2;\n\t\t\tcolumn-gap: 20rpx;\n\t\t}\n\n\t\t.item-masonry {\n\t\t\tbox-sizing: border-box;\n\t\t\tborder-radius: 15rpx;\n\t\t\toverflow: hidden;\n\t\t\tbackground-color: #fff;\n\t\t\tbreak-inside: avoid;\n\t\t\t/*避免在元素内部插入分页符*/\n\t\t\tbox-sizing: border-box;\n\t\t\tmargin-bottom: 20rpx;\n\t\t\tbox-shadow: 0px 0px 28rpx 1rpx rgba(78, 101, 153, 0.07);\n\t\t}\n\n\t\t.item-masonry image {\n\t\t\twidth: 100%;\n\t\t}\n\n\t\t.listtitle {\n\t\t\tpadding: 22rpx;\n\t\t\tpadding-top: 10rpx;\n\t\t\tfont-size: 28rpx;\n\n\t\t\t.listtitle1 {\n\t\t\t\tline-height: 39rpx;\n\t\t\t}\n\n\t\t\t.listtitle3 {\n\t\t\t\tfont-size: 40rpx;\n\t\t\t\tline-height: 32rpx;\n\t\t\t\tcolor: rgb(170, 0, 0);\n\t\t\t\tpadding-top: 22rpx;\n\n\t\t\t\ttext {\n\t\t\t\t\tfont-size: 32rpx;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\n.shopName {\n\tfont-family: '阿里妈妈方圆体 VF Regular';\n\t// font-weight: 600;\n\tpadding: 40rpx 20rpx;\n\tcolor: #4d0000;\n\n\t.shopTitle {\n\t\tfont-size: 60rpx;\n\t\tfont-weight: bold;\n\t}\n\n\t.shopEngTitle {\n\t\tmargin-top: 5rpx;\n\t\tfont-size: 26rpx;\n\t}\n}\n\n.input {\n\tfont-family: '阿里妈妈方圆体 VF Regular';\n\twidth: 95%;\n\theight: 80rpx;\n\tbackground-color: #fffbf2;\n\tmargin: auto;\n\tborder-radius: 20rpx;\n\tmargin-bottom: 30rpx;\n\t// margin-top: -20rpx;\n\tdisplay: flex;\n\talign-items: center;\n\tposition: relative;\n\tbackground-color: #fff;\n\tbox-shadow: rgba(0, 0, 0, 0.05) 0px 0px 0px 1px;\n\n\tinput {\n\t\tpadding-left: 100rpx;\n\t\twidth: 80%;\n\t\tcolor: #4d0000;\n\t}\n\n\timage {\n\t\tposition: absolute;\n\t\twidth: 52rpx;\n\t\theight: 52rpx;\n\t\tleft: 4%;\n\t}\n}\n\n.recommend {\n\twidth: 95%;\n\tmargin: auto;\n\tdisplay: flex;\n\tjustify-content: space-around;\n\talign-items: center;\n\tmargin-bottom: 30rpx;\n\tcolor: #4d0000;\n\tfont-family: '阿里妈妈方圆体 VF Regular' !important;\n\n\tview {\n\t\twidth: 17%;\n\t\tpadding: 15rpx 0;\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\tfont-size: 28rpx;\n\n\t\t&.active {\n\t\t\t// padding: 10rpx 40rpx;\n\t\t\tborder-radius: 40rpx;\n\t\t\tcolor: #fff;\n\t\t\tbackground-color: #4d0000;\n\t\t\t// transition: background-color 0.3s, top: \t\t;ransform 0.3s; // 添加过渡效果\n\t\t}\n\t}\n}\n\n.recommendItem {\n\tfont-family: '阿里妈妈方圆体 VF Regular' !important;\n\twidth: 95%;\n\theight: 350rpx;\n\tmargin: auto;\n\tborder-radius: 40rpx !important;\n\toverflow: hidden;\n\tbox-shadow: rgba(0, 0, 0, 0.1) 0px 4px 12px;\n\n\t.item {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tbackground-color: #fff;\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\n\t\t.itemImage {\n\t\t\ttransform: scale(0.95);\n\t\t\twidth: 50%;\n\t\t\theight: 100%;\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: center;\n\t\t\talign-items: center;\n\n\t\t\timage {\n\t\t\t\twidth: 300rpx;\n\t\t\t\theight: 300rpx;\n\t\t\t\tborder-radius: 40rpx;\n\t\t\t}\n\t\t}\n\n\t\t.itemText {\n\t\t\ttransform: scale(0.95);\n\t\t\twidth: 50%;\n\t\t\theight: 100%;\n\t\t\t// display: flex;\n\t\t\t// flex-direction: column;\n\t\t\t// justify-content: space-around;\n\n\t\t\t.title {\n\t\t\t\twidth: 320rpx;\n\t\t\t\tfont-size: 40rpx;\n\t\t\t\tcolor: #4d0000;\n\t\t\t\tfont-weight: bold;\n\t\t\t\theight: 100rpx;\n\t\t\t\tline-height: 100rpx;\n\t\t\t\tbox-sizing: border-box;\n\t\t\t\toverflow: hidden;\n\t\t\t\ttext-overflow: ellipsis;\n\t\t\t\twhite-space: nowrap;\n\t\t\t\tpadding-right: 5%;\n\t\t\t}\n\n\t\t\t.info {\n\t\t\t\theight: 45%;\n\t\t\t\tfont-size: 22rpx;\n\t\t\t}\n\n\t\t\t.price {\n\t\t\t\theight: 25%;\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: space-between;\n\t\t\t\talign-items: center;\n\t\t\t\twidth: 95%;\n\n\t\t\t\t.left {\n\t\t\t\t\tcolor: rgb(170, 0, 0);\n\t\t\t\t\tfont-size: 40rpx;\n\n\t\t\t\t\ttext {\n\t\t\t\t\t\tfont-size: 32rpx;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t.right {\n\t\t\t\t\tpadding: 10rpx 25rpx;\n\t\t\t\t\tbackground-color: #4d0000;\n\t\t\t\t\tborder-radius: 40rpx;\n\t\t\t\t\tcolor: #fff;\n\t\t\t\t\tfont-size: 30rpx;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n</style>\n","import MiniProgramPage from 'C:/Users/18706/Desktop/MZ/mazu-前端小程序/pages/shop/shop.vue'\nwx.createPage(MiniProgramPage)"],"names":["item","getShopGridAPI","uni","getShopListAPI"],"mappings":";;;;AAqEA,MAAA,WAAA,MAAA;AACA,MAAA,SAAA,MAAA;AACA,MAAA,aAAA,MAAA;AAEA,MAAA,YAAA;AAAA,EACC,OAAA;AACC,WAAA;AAAA;QAEE,WAAA;AAAA;QAEA,UAAA;AAAA,QACA,YAAA;AAAA;;MAGD,MAAA,CAAA;AAAA,MACA,eAAA,CAAA;AAAA;;;;EAKF,SAAA;AACC,SAAA,YAAA;AAAA;EAED,SAAA;AACC,SAAA,cAAA,GAAA;AAAA,MACC,MAAA;AAAA,IACD,CAAA;AACA,SAAA,QAAA;AAAA;;IAGA;AAAA,IACA;AAAA,IACA;AAAA;EAED,SAAA;AAAA;AAAA,IAEC,YAAA,OAAA;;AAIC,aAAA,MAAA,GAAA,IAAA,SAAA,IAAA,QAAA,CAAA;AAAA;;;;;AAMA,eAAA,IAAA,SAAA,SAAA,GAAA,IAAA,GAAA,KAAA;AACC,cAAA,IAAA,KAAA,MAAA,KAAA,YAAA,IAAA,EAAA;;MAED;;;;;;AAQE,YAAA,OAAA,IAAA,SAAA;AACC,eAAA,OAAA,IAAA,QAAA,IAAA,CAAAA,UAAA;AACC,mBAAA;AAAA,cACC,GAAAA;AAAA;;;UAGF,CAAA;AAAA;;QAGD;AAAA,SAED,MAAA,CAAA,QAAA;;;MAGA,CAAA;AAAA;;IAGF,UAAA;AACCC,+BAAA;AAGE,cAAA,gBAAA,2BAAA,YAAA;AAEA,cAAA,eAAA,aAAA,OAAA,CAAA,UAAA,6BAAA,UAAA,IAAA;;;AAMC,mBAAA,IAAA,SAAA,SAAA,GAAA,IAAA,GAAA,KAAA;AACC,kBAAA,IAAA,KAAA,MAAA,KAAA,YAAA,IAAA,EAAA;;UAED;;;AAKD,cAAA,eAAA,aAAA,YAAA;AAEA,cAAA,gBAAA,aAAA,SAAA,IAAA,aAAA,MAAA,GAAA,CAAA,IAAA;;SAID,MAAA,CAAA,QAAA;AACCC,sBAAA,MAAA,MAAA,SAAA,8BAAA,aAAA,GAAA;AAED,aAAA,WAAA,CAAA,EAAA,MAAA,KAAA,GAAA,EAAA,MAAA,KAAA,CAAA;AAAA,MACA,CAAA;AAAA;;;AAIDC,+BAAA;AAGE,YAAA,OAAA,IAAA,SAAA;AACC,eAAA,OAAA,IAAA,QAAA,IAAA,CAAA,SAAA;AACC,mBAAA;AAAA,cACC,GAAA;AAAA;;;UAGF,CAAA;;;;AAIA,eAAA,gBAAA;QACD;AAAA,SAED,MAAA,CAAA,QAAA;AACCD,sBAAA,MAAA,MAAA,SAAA,8BAAA,aAAA,GAAA;;AAEA,aAAA,gBAAA;MACD,CAAA;AAAA;;IAGF,aAAA,IAAA;;AAECA,oBAAAA,MAAA,WAAA;AAAA;MAEA,CAAA;AAAA,IACD;AAAA;EAED,aAAA,GAAA;AACC,QAAA,EAAA,aAAA,IAAA;AACC,WAAA,UAAA,aAAA;AAAA,IACD;AACA,QAAA,EAAA,YAAA,IAAA;AACC,WAAA,UAAA,aAAA;AAAA,IACD;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtNA,GAAG,WAAW,eAAe;"}