{"version":3,"file":"ai-chat.js","sources":["pages/ai-chat/ai-chat.vue","E:/HBuilderX.4.66.2025051912/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYWktY2hhdC9haS1jaGF0LnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"page-container\">\n\t\t<!-- 顶部标题栏 -->\n\t\t<view class=\"title-bar\">\n\t\t\t<text class=\"title-text\">海丝文化助手-小默</text>\n\t\t\t<button class=\"close-btn\" @click=\"closePage\">×</button>\n\t\t</view>\n\n\t\t<!-- 初始提示弹窗 -->\n\t\t<view class=\"popup\" v-if=\"showPopup\">\n\t\t\t<view class=\"popup-content\">\n\t\t\t\t<text class=\"popup-desc\">你好呀！我是海丝文化助手，有什么关于海丝文化的问题都可以问我。</text>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- 聊天记录区域 -->\n\t\t<scroll-view class=\"chat-content\" scroll-y=\"true\" :scroll-top=\"scrollTop\">\n\t\t\t<!-- 用户消息 -->\n\t\t\t<view class=\"msg-item user-item\" v-for=\"(item, idx) in chatList\" :key=\"idx\" v-if=\"item.role === 'user'\">\n\t\t\t\t<view class=\"msg-bubble user-bubble\">\n\t\t\t\t\t{{ item.content }}\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<!-- AI消息 -->\n\t\t\t<view class=\"msg-item ai-item\" v-for=\"(item, idx) in chatList\" :key=\"idx\" v-if=\"item.role === 'ai'\">\n\t\t\t\t<view class=\"msg-bubble ai-bubble\">\n\t\t\t\t\t{{ item.content }}\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</scroll-view>\n\n\t\t<!-- 底部输入区域 -->\n\t\t<view class=\"input-area\">\n\t\t\t<input v-model=\"inputMsg\" placeholder=\"请输入关于海丝文化的问题...\" class=\"msg-input\" />\n\t\t\t<button @click=\"sendMsg\" class=\"send-btn\">发送</button>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\n// 显式导出模块（解决依赖分析识别问题）\nmodule.exports = {\n\tname: 'AiChatPage'\n};\n\nexport default {\n\tname: 'AiChatPage', // 页面名称标识\n\tdata() {\n\t\treturn {\n\t\t\tshowPopup: true,\n\t\t\tinputMsg: '',\n\t\t\tchatList: [],\n\t\t\tscrollTop: 0,\n\t\t\tsessionId: ''\n\t\t};\n\t},\n\tonLoad() {\n\t\t// 生成唯一sessionId\n\t\tthis.generateSessionId();\n\t\t// 【关键】非TabBar页面，绝对不调用uni.hideTabBar()！！！\n\t},\n\tmethods: {\n\t\t// 生成动态sessionId\n\t\tgenerateSessionId() {\n\t\t\tthis.sessionId = `user-${Date.now()}-${Math.floor(Math.random() * 10000)}`;\n\t\t},\n\n\t\t// 发送消息\n\t\tsendMsg() {\n\t\t\tconst msg = this.inputMsg.trim();\n\t\t\tif (!msg) return uni.showToast({ title: '请输入内容', icon: 'none' });\n\n\t\t\t// 添加用户消息到聊天记录\n\t\t\tthis.chatList.push({ role: 'user', content: msg });\n\t\t\tthis.inputMsg = '';\n\t\t\t// 调用AI接口\n\t\t\tthis.callAIApi(msg);\n\t\t\t// 滚动到底部\n\t\t\tthis.scrollToBottom();\n\t\t},\n\n\t\t// 调用AI对话接口\n\t\tasync callAIApi(message) {\n\t\t\tuni.showLoading({ title: '回复中...' });\n\t\t\ttry {\n\t\t\t\tconst res = await uni.request({\n\t\t\t\t\turl: 'https://47.95.210.123:8080/user/user/chat',\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tmessage: message,\n\t\t\t\t\t\tsessionId: this.sessionId\n\t\t\t\t\t},\n\t\t\t\t\theader: { 'Content-Type': 'application/json' },\n\t\t\t\t\ttimeout: 20000\n\t\t\t\t});\n\t\t\t\t// 处理AI回复（根据接口实际返回字段调整）\n\t\t\t\tconst reply = res.data?.content || res.data?.message || '已收到你的问题，正在处理~';\n\t\t\t\tthis.chatList.push({ role: 'ai', content: reply });\n\t\t\t} catch (err) {\n\t\t\t\tconsole.error('接口调用失败：', err);\n\t\t\t\tthis.chatList.push({ role: 'ai', content: '网络异常，请稍后重试' });\n\t\t\t} finally {\n\t\t\t\tuni.hideLoading();\n\t\t\t\tthis.scrollToBottom();\n\t\t\t}\n\t\t},\n\n\t\t// 滚动到聊天底部\n\t\tscrollToBottom() {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.scrollTop = 99999;\n\t\t\t}, 100);\n\t\t},\n\n\t\t// 关闭页面（适配非TabBar页面返回）\n\t\tclosePage() {\n\t\t\tuni.navigateBack({\n\t\t\t\tdelta: 1,\n\t\t\t\tfail: () => {\n\t\t\t\t\t// 若返回失败（页面栈为空），跳转到首页\n\t\t\t\t\tuni.redirectTo({ url: '/pages/index/index' });\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n};\n</script>\n\n<style scoped>\n/* 页面容器 */\n.page-container {\n\twidth: 100%;\n\theight: 100vh;\n\tbackground-color: #f8f0e3;\n\tfont-family: 'SimSun', serif;\n}\n\n/* 顶部标题栏 */\n.title-bar {\n\theight: 80rpx;\n\tbackground-color: #8b2323;\n\tcolor: #fff;\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tpadding: 0 20rpx;\n\tfont-size: 32rpx;\n}\n.close-btn {\n\tbackground: transparent;\n\tcolor: #fff;\n\tfont-size: 36rpx;\n\tpadding: 0;\n\tborder: none;\n}\n\n/* 初始弹窗 */\n.popup {\n\tmargin: 30rpx auto;\n\twidth: 90%;\n\tborder: 2rpx solid #8b2323;\n\tbackground-color: #fff;\n\tpadding: 20rpx;\n\tborder-radius: 8rpx;\n}\n.popup-desc {\n\tfont-size: 28rpx;\n\tcolor: #333;\n\tline-height: 1.6;\n}\n\n/* 聊天内容区域 */\n.chat-content {\n\tpadding: 20rpx;\n\theight: calc(100vh - 200rpx);\n}\n\n/* 消息项 */\n.msg-item {\n\tmargin-bottom: 30rpx;\n\tmax-width: 85%;\n}\n.user-item {\n\tmargin-left: auto;\n}\n.ai-item {\n\tmargin-right: auto;\n}\n\n/* 消息气泡 */\n.msg-bubble {\n\tpadding: 20rpx 25rpx;\n\tborder-radius: 8rpx;\n\tfont-size: 28rpx;\n\tline-height: 1.6;\n}\n.user-bubble {\n\tbackground-color: #e6f7ff;\n\tborder: 2rpx solid #b8d8e8;\n}\n.ai-bubble {\n\tbackground-color: #fff;\n\tborder: 2rpx solid #8b2323;\n}\n\n/* 底部输入区域 */\n.input-area {\n\tdisplay: flex;\n\tpadding: 20rpx;\n\tgap: 15rpx;\n\talign-items: center;\n\tbackground-color: #f8f0e3;\n}\n.msg-input {\n\tflex: 1;\n\theight: 70rpx;\n\tpadding: 0 20rpx;\n\tborder: 2rpx solid #8b2323;\n\tborder-radius: 8rpx;\n\tbackground-color: #fff;\n\tfont-size: 28rpx;\n}\n.send-btn {\n\theight: 70rpx;\n\tpadding: 0 30rpx;\n\tbackground-color: #8b2323;\n\tcolor: #fff;\n\tborder-radius: 8rpx;\n\tfont-size: 28rpx;\n\tborder: none;\n}\n</style>\n","import MiniProgramPage from 'D:/01前端学习/01fzhx/mazu-2/mazu-2/mazu-前端小程序/pages/ai-chat/ai-chat.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":";;AA0CA,OAAO,UAAU;AAAA,EAChB,MAAM;AACP;AAEA,MAAK,YAAU;AAAA,EACd,MAAM;AAAA;AAAA,EACN,OAAO;AACN,WAAO;AAAA,MACN,WAAW;AAAA,MACX,UAAU;AAAA,MACV,UAAU,CAAE;AAAA,MACZ,WAAW;AAAA,MACX,WAAW;AAAA;EAEZ;AAAA,EACD,SAAS;AAER,SAAK,kBAAiB;AAAA,EAEtB;AAAA,EACD,SAAS;AAAA;AAAA,IAER,oBAAoB;AACnB,WAAK,YAAY,QAAQ,KAAK,IAAG,CAAE,IAAI,KAAK,MAAM,KAAK,OAAS,IAAE,GAAK,CAAC;AAAA,IACxE;AAAA;AAAA,IAGD,UAAU;AACT,YAAM,MAAM,KAAK,SAAS,KAAI;AAC9B,UAAI,CAAC;AAAK,eAAOA,cAAAA,MAAI,UAAU,EAAE,OAAO,SAAS,MAAM,OAAO,CAAC;AAG/D,WAAK,SAAS,KAAK,EAAE,MAAM,QAAQ,SAAS,IAAE,CAAG;AACjD,WAAK,WAAW;AAEhB,WAAK,UAAU,GAAG;AAElB,WAAK,eAAc;AAAA,IACnB;AAAA;AAAA,IAGD,MAAM,UAAU,SAAS;;AACxBA,oBAAAA,MAAI,YAAY,EAAE,OAAO,SAAU,CAAA;AACnC,UAAI;AACH,cAAM,MAAM,MAAMA,cAAG,MAAC,QAAQ;AAAA,UAC7B,KAAK;AAAA,UACL,QAAQ;AAAA,UACR,MAAM;AAAA,YACL;AAAA,YACA,WAAW,KAAK;AAAA,UAChB;AAAA,UACD,QAAQ,EAAE,gBAAgB,mBAAoB;AAAA,UAC9C,SAAS;AAAA,QACV,CAAC;AAED,cAAM,UAAQ,SAAI,SAAJ,mBAAU,cAAW,SAAI,SAAJ,mBAAU,YAAW;AACxD,aAAK,SAAS,KAAK,EAAE,MAAM,MAAM,SAAS,MAAI,CAAG;AAAA,MAChD,SAAO,KAAK;AACbA,+EAAc,WAAW,GAAG;AAC5B,aAAK,SAAS,KAAK,EAAE,MAAM,MAAM,SAAS,aAAa,CAAC;AAAA,MACzD,UAAU;AACTA,sBAAG,MAAC,YAAW;AACf,aAAK,eAAc;AAAA,MACpB;AAAA,IACA;AAAA;AAAA,IAGD,iBAAiB;AAChB,iBAAW,MAAM;AAChB,aAAK,YAAY;AAAA,MACjB,GAAE,GAAG;AAAA,IACN;AAAA;AAAA,IAGD,YAAY;AACXA,oBAAAA,MAAI,aAAa;AAAA,QAChB,OAAO;AAAA,QACP,MAAM,MAAM;AAEXA,wBAAAA,MAAI,WAAW,EAAE,KAAK,qBAAsB,CAAA;AAAA,QAC7C;AAAA,MACD,CAAC;AAAA,IACF;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7HA,GAAG,WAAW,eAAe;"}